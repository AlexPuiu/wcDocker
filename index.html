<!DOCTYPE HTML>
<html>
  <head>
    <title>Web Cabin Docker Demo</title>
    <!-- External modules -->
    <link rel="shortcut icon" href="favicon.ico">
    <link rel="stylesheet" type="text/css" href="Code/style.css"/>
    <link rel="stylesheet" type="text/css" href="Code/ext/jquery.contextMenu.css"/>
    <script src="Code/ext/jquery-2.1.1.min.js"></script>
    <script src="Code/ext/jquery.contextMenu.js"></script>
    <script src="Code/ext/jquery.ui.position.js"></script>

    <!-- Core Modules -->
    <script src="Code/docker.js"></script>
    <script src="Code/splitter.js"></script>
    <script src="Code/frame.js"></script>
    <script src="Code/panel.js"></script>
    <script src="Code/layout.js"></script>
    <script src="Code/ghost.js"></script>

    <!-- Initialization -->
    <script>
      $(document).ready(function() {
        var myDocker = new wcDocker(document.body);
        if (myDocker) {

          myDocker.center().addItem($('<div style="text-align:center">Central Window<br>This is always present and should contain your main content or view.<br></div>'));
          
          var layoutConfiguration;

          myDocker.registerPanelType('Top Panel', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center"><strong>Welcome to the Web Cabin Docker!</strong><br>Web Cabin Docker is a docking panel layout interface written in JavaScript under the <a href="http://www.opensource.org/licenses/mit-license.php">MIT License</a>.</div>'), 0, 0);
            myPanel.layout().addItem($('<div style="text-align:center">View the source here: <a href="https://bitbucket.org/WebCabin/wcdocker">https://bitbucket.org/WebCabin/wcdocker</a></div>'), 0, 1);
            myPanel.size(100, 100);
            myPanel.minSize(100, 100);
            myPanel.maxSize(100, 100);
            myPanel.moveable(false);
            myPanel.closeable(false);

            var $saveButton = $('<button style="position:absolute;right:10px;top:10px;">Remember Layout</button>');
            var $restoreButton = $('<button style="position:absolute;right:10px;top:50px;">Restore Layout</button>');
            myPanel.layout().addItem($saveButton);
            myPanel.layout().addItem($restoreButton);
            myPanel.layout().addItem($('<div style="position:absolute;width:200px;height:20px;left:10px;top:10px;background-color:darkgray;text-align:center;" class="testMenu">Custom Context Menu here</div>'));

            var saveTimer;
            $restoreButton.attr('disabled', layoutConfiguration? false: true);
            $saveButton.click(function() {
              if (saveTimer) {
                clearTimeout(saveTimer);
                saveTimer = 0;
              }

              layoutConfiguration = myDocker.save();

              $saveButton.html('<b>Remembered!</b>');
              $restoreButton.attr('disabled', false);
              saveTimer = setTimeout(function() {
                $saveButton.text('Remember Layout');
                saveTimer = 0;
              }, 500);
            });

            $restoreButton.click(function() {
              if (layoutConfiguration) {
                myDocker.restore(layoutConfiguration);
              }
            });
          }, true);

          myDocker.registerPanelType('Panel 1', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center">All panels contain a gridded layout.</div>'), 0, 0, 1, 2);
            myPanel.layout().addItem($('<div style="text-align:center">This is a panel.</div>'), 1, 0);
            myPanel.layout().addItem($('<div style="text-align:center">Each grid cell can be used individually...</div>'), 1, 1);
            myPanel.layout().addItem($('<div style="text-align:center">or multiple cells can be merged.</div>'), 0, 2, 2, 1);
            myPanel.layout().showGrid(true);
            myPanel.size(200, 200);
          });

          myDocker.registerPanelType('Panel 2', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center">Each panel can be docked anywhere.<br>Just drag me by my title bar to a new dock position.</div>'));
            myPanel.size(400, 400);
          });

          myDocker.registerPanelType('Panel 3', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center">New (and even duplicate) panels can be created by right clicking at the location you wish the new panel to go and using the context menu.</div>'));
          });

          myDocker.registerPanelType('Panel 4', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center">Floating panels can move freely.<br>Drag me by my title bar.</div>'));

            var $dockMe = $('<div style="text-align:center"><b>To dock me</b>, drag me by the tab you wish to dock, or dock the entire frame by dragging the title bar with the middle mouse.</div>');
            var $floatMe = $('<div style="text-align:center"><b>To make me float again</b>, drag a tab to a location that does not anchor to a docking position, or drag the entire frame by using the middle mouse on the title bar.</div>');
            myPanel.layout().addItem($dockMe, 0, 1);
            myPanel.size(400, 300);
            myPanel.pos(0.35, 0.8);

            // Now register some events.
            myPanel.on(wcDocker.EVENT_ATTACHED, function(myPanel) {
              $dockMe.remove();
              myPanel.layout().addItem($floatMe, 0, 1);
            });
            myPanel.on(wcDocker.EVENT_DETACHED, function(myPanel) {
              $floatMe.remove();
              myPanel.layout().addItem($dockMe, 0, 1);
            });
          });

          myDocker.registerPanelType('Panel 5', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center"></div>'));

            var $attachInfo = $('<div style="text-align:center">I react when docked</div>');
            var $attached   = $('<div style="text-align:center"><b>I was just docked!</b></div>');
            var $detachInfo = $('<div style="text-align:center">I react when detached</div>');
            var $detached   = $('<div style="text-align:center"><b>I was just detached!</b></div>');
            var attachTimer;

            var $moveInfo = $('<div style="text-align:center">I react on move</div>');
            var $moved    = $('<div style="text-align:center"><b>I was just moved!</b></div>');
            var moveTimer;

            var $resizeInfo = $('<div style="text-align:center">I react on resize</div>');
            var $resized    = $('<div style="text-align:center"><b>I was just resized!</b></div>');
            var resizeTimer;

            myPanel.layout().addItem($detachInfo, 0, 0);
            myPanel.layout().addItem($moveInfo, 0, 1);
            myPanel.layout().addItem($resizeInfo, 0, 2);

            // Now register some events.
            myPanel.on(wcDocker.EVENT_ATTACHED, function(myPanel) {
              if (attachTimer) {
                clearTimeout(attachTimer);
              }

              $attachInfo.remove();
              $detachInfo.remove();
              $detached.remove();
              myPanel.layout().addItem($attached, 0, 0);

              attachTimer = setTimeout(function() {
                $attached.remove();
                myPanel.layout().addItem($detachInfo, 0, 0);
              }, 1000);
            });
            myPanel.on(wcDocker.EVENT_DETACHED, function(myPanel) {
              if (attachTimer) {
                clearTimeout(attachTimer);
              }

              $attachInfo.remove();
              $detachInfo.remove();
              $detached.remove();
              myPanel.layout().addItem($detached, 0, 0);

              attachTimer = setTimeout(function() {
                $detached.remove();
                myPanel.layout().addItem($attachInfo, 0, 0);
              }, 1000);
            });
            myPanel.on(wcDocker.EVENT_MOVED, function(myPanel) {
              if (moveTimer) {
                clearTimeout(moveTimer);
              }

              $moveInfo.remove();
              myPanel.layout().addItem($moved, 0, 1);

              moveTimer = setTimeout(function() {
                $moved.remove();
                myPanel.layout().addItem($moveInfo, 0, 1);
                moveTimer = null;
              }, 500);
            });
            myPanel.on(wcDocker.EVENT_RESIZED, function(myPanel) {
              if (resizeTimer) {
                clearTimeout(resizeTimer);
              }

              $resizeInfo.remove();
              myPanel.layout().addItem($resized, 0, 2);

              resizeTimer = setTimeout(function() {
                $resized.remove();
                myPanel.layout().addItem($resizeInfo, 0, 2);
                resizeTimer = null;
              }, 500);
            });
          });

          myDocker.registerPanelType('Panel 6', function(myPanel) {
            myPanel.layout().addItem($('<div style="text-align:center">I should start out as a second tab to a panel frame, but can be moved elsewhere like the others.</div>'));
          });

          myDocker.addPanel('Top Panel', wcDocker.DOCK_TOP, false);
          var panel1 = myDocker.addPanel('Panel 1', wcDocker.DOCK_LEFT, false);
          var panel2 = myDocker.addPanel('Panel 2', wcDocker.DOCK_RIGHT, false);
          myDocker.addPanel('Panel 3', wcDocker.DOCK_BOTTOM, false, panel2);
          myDocker.addPanel('Panel 4', wcDocker.DOCK_FLOAT, false);
          myDocker.addPanel('Panel 5', wcDocker.DOCK_BOTTOM, false, panel2);
          myDocker.addPanel('Panel 6', wcDocker.DOCK_BOTTOM, true, panel1);

          // Setup our context menus.
          myDocker.basicMenu('.testMenu', [
            {name: 'option1', callback: function(key, opts){alert(key);}},
            {name: 'option2', callback: function(key, opts){alert(key);}},
            {name: 'option3', callback: function(key, opts){alert(key);}},
          ]);
        }
      });
    </script>
  </head>
  <body style="background-color: lightgrey;">
  </body>
</html>